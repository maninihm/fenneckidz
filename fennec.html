<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Fennec Kids â€“ DÃ©mo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #f1fff5, #e6f5ff);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .app {
      width: 100%;
      max-width: 900px;
      background: #ffffff;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .header {
      background: linear-gradient(90deg, #1e9c5b, #0099cc);
      color: #fff;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .header-logo {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: #1e9c5b;
      font-weight: bold;
    }
    .header-title {
      font-size: 20px;
      font-weight: 700;
    }
    .header-sub {
      font-size: 12px;
      opacity: 0.9;
    }
    .chat {
      padding: 16px;
      height: 450px;
      overflow-y: auto;
      background: #f7fbff;
    }
    .msg {
      margin-bottom: 12px;
      display: flex;
    }
    .msg.you { justify-content: flex-end; }
    .bubble {
      max-width: 70%;
      padding: 10px 14px;
      border-radius: 14px;
      font-size: 14px;
      line-height: 1.4;
      white-space: pre-wrap;
    }
    .you .bubble {
      background: #1e9c5b;
      color: #fff;
      border-bottom-right-radius: 2px;
    }
    .fennec .bubble {
      background: #ffffff;
      color: #123;
      border-bottom-left-radius: 2px;
      border: 1px solid #e0ecff;
    }
    .fennec .avatar {
      margin-right: 8px;
      font-size: 18px;
    }
    .suggestions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 0 16px 8px;
    }
    .suggestion-btn {
      border: none;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      background: #e8f7ef;
      color: #05623a;
      cursor: pointer;
    }
    .suggestion-btn:hover { background: #d6f0e3; }
    .input-area {
      border-top: 1px solid #dde7f5;
      padding: 10px 12px;
      display: flex;
      gap: 8px;
    }
    .input-area input {
      flex: 1;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid #cdd9ee;
      font-size: 14px;
      outline: none;
    }
    .input-area button {
      border-radius: 999px;
      border: none;
      padding: 0 16px;
      background: #1e9c5b;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }
    .input-area button:hover { background: #16814a; }
  </style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="header-logo">ðŸ¦Š</div>
    <div>
      <div class="header-title">Fennec Kids â€“ DÃ©mo</div>
      <div class="header-sub">Assistant Ã©ducatif pour enfants algÃ©riens (6â€“12 ans)</div>
    </div>
  </div>

  <div id="chat" class="chat"></div>

  <div class="suggestions" id="suggestions"></div>

  <div class="input-area">
    <input id="userInput" type="text" placeholder="Ã‰cris ta question ici..." />
    <button id="sendBtn">Envoyer</button>
  </div>
</div>

<script>
  // --- Base de connaissances (FR + darija). Tu peux en rajouter autant que tu veux ---
  const QA_BASE = [
    // SALUT / INTRO
    {
      patterns: ["bonjour", "slt", "salut", "bonsoir"],
      answer: "Salam! ðŸ˜Š Je suis Fennec, ton ami intelligent. Comment tu vas aujourd'hui?",
      suggestions: ["Qui es-tu ?", "Aide-moi pour les maths", "Je suis triste"]
    },
    {
      patterns: ["qui es tu", "t es qui", "c est qui fennec", "qui tu es"],
      answer: "Je suis Fennec ðŸ¦Š, une IA algÃ©rienne pour aider les enfants dans leurs devoirs, leurs Ã©motions et leurs rÃªves!",
      suggestions: ["Aide-moi pour un exercice", "Explique moi quelque chose", "Raconte une petite histoire"]
    },

    // MATHS â€“ ADDITIONS (FR + darija)
    {
      patterns: ["1+1", "1 + 1", "combien font 1+1"],
      answer: "1 + 1 = 2 ðŸŽ¯ Si tu as 1 bonbon et on tâ€™en donne encore 1, tu en as 2.",
      suggestions: ["Donne-moi un autre calcul", "Explique une soustraction", "Explique 2+3"]
    },
    {
      patterns: ["2+3", "2 + 3", "combien font 2+3"],
      answer: "2 + 3 = 5 ðŸŽ¯ Imagine 2 voitures jouets et 3 autres, Ã§a fait 5 voitures.",
      suggestions: ["Donne un calcul plus difficile", "Explique 3+5", "Explique 4+4"]
    },
    {
      patterns: ["3+5", "3 + 5", "combien font 3+5"],
      answer: "3 + 5 = 8 ðŸŽ¯ Imagine 3 bonbons puis encore 5, Ã§a fait 8 bonbons au total.",
      suggestions: ["Donne-moi 4+4", "Autre calcul facile", "Soustraction simple"]
    },
    {
      patterns: ["4+4", "4 + 4", "combien font 4+4"],
      answer: "4 + 4 = 8 ðŸ˜Š 4 crayons dâ€™un cÃ´tÃ©, 4 de lâ€™autre, au total 8 crayons.",
      suggestions: ["Explique 5+5", "Donne un calcul avec 10", "Donne un problÃ¨me de bonbons"]
    },
    {
      patterns: ["5+5", "5 + 5", "combien font 5+5"],
      answer: "5 + 5 = 10 ðŸŽ‰ Câ€™est comme 10 doigts sur tes deux mains.",
      suggestions: ["Explique 6+4", "Donne une addition avec 9", "Explique une soustraction"]
    },
    {
      patterns: ["3+2", "3 + 2", "combien font 3+2"],
      answer: "3 + 2 = 5 ðŸŽ¯ Kan 3andek 3 bonbons w zidna 2, ywaliu 5.",
      suggestions: ["Donne-moi 4+4", "Autre calcul facile", "Soustraction simple"]
    },
    {
      patterns: ["7+2", "7 + 2", "combien font 7+2"],
      answer: "7 + 2 = 9 ðŸ˜Š Imagine 7 koura w zidtha 2, twaliu 9.",
      suggestions: ["Donne une autre addition", "Explique 3+5", "Donne un problÃ¨me"]
    },
    {
      patterns: ["2+2", "2 + 2", "combien font 2+2"],
      answer: "2 + 2 = 4 ðŸŽ¯ 2 voitures + 2 voitures, y3tina 4 voitures.",
      suggestions: ["Explique 5+5", "Encore un calcul", "Soustraction facile"]
    },
    {
      patterns: ["4+5", "4 + 5", "combien font 4+5"],
      answer: "4 + 5 = 9 ðŸ”¢ 4 jouets + 5 jouets, ywalli 3andek 9 jouets.",
      suggestions: ["Explique 5+4", "Donne un calcul plus grand", "Soustraction 9-4"]
    },
    {
      patterns: ["8+1", "8 + 1", "combien font 8+1"],
      answer: "8 + 1 = 9 ðŸŒŸ 8 Ã©toiles f sama w zedna wa7da, twaliu 9.",
      suggestions: ["Explique 9+1", "Explique 7+3", "Question sur les Ã©toiles"]
    },

    // MATHS â€“ SOUSTRACTIONS
    {
      patterns: ["6-2", "6 - 2", "combien font 6-2"],
      answer: "6 - 2 = 4 âž– Si tu as 6 jouets et tu en donnes 2, il tâ€™en reste 4.",
      suggestions: ["Encore une soustraction", "Addition plus difficile", "Multiplication simple"]
    },
    {
      patterns: ["5-3", "5 - 3", "combien font 5-3"],
      answer: "5 - 3 = 2 âž– 5 biscuits moins 3, ybqaw ghir 2 biscuits.",
      suggestions: ["Donne une autre soustraction", "Explique 4-1", "Donne un problÃ¨me avec des biscuits"]
    },

    // CULTURE / ALGÃ‰RIE
    {
      patterns: ["casbah", "la casbah", "c est quoi la casbah"],
      answer: "La Casbah d'Alger, câ€™est le vieux quartier historique ðŸ°. Il y a des ruelles Ã©troites, des maisons anciennes et beaucoup dâ€™histoire de lâ€™AlgÃ©rie ðŸ‡©ðŸ‡¿.",
      suggestions: ["Parle-moi d'Alger", "Parle-moi du Sahara", "Parle-moi de lâ€™AlgÃ©rie"]
    },
    {
      patterns: ["parle de l algerie", "parle de lâ€™algÃ©rie", "pays algerie"],
      answer: "Lâ€™AlgÃ©rie est un pays magnifique: mer, montagnes, Sahara, histoire et cultures diffÃ©rentes ðŸ‡©ðŸ‡¿. Tu fais partie de cette richesse, et tu peux en Ãªtre fier!",
      suggestions: ["Parle du Sahara", "Parle de la Kabylie", "Parle dâ€™Alger"]
    },

    // LANGUES
    {
      patterns: ["comment dire bonjour en arabe", "bonjour en arabe"],
      answer: "[translate:Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…] (salam aleykoum) ou [translate:Ù…Ø±Ø­Ø¨Ø§] (marhaban) ðŸ•Œ. Ce sont des faÃ§ons polies de dire bonjour.",
      suggestions: ["Comment dire merci ?", "Comment dire au revoir ?", "Autres mots en arabe"]
    },
    {
      patterns: ["comment dire bonjour en anglais", "bonjour en anglais"],
      answer: "On dit \"Hello\" ou \"Hi\" en anglais ðŸ‘‹. Tu peux dire: \"Hello, my name is ...\".",
      suggestions: ["Apprends-moi une phrase", "Comment dire merci en anglais ?", "Comment dire bonne nuit ?"]
    },

    // Ã‰MOTIONS / BIEN-ÃŠTRE (bloc de 20 dÃ©jÃ  fourni)
    {
      patterns: ["je suis fatigue", "je suis fatiguÃ©", "je suis crevÃ©"],
      answer: "Quand tu es fatiguÃ© ðŸ˜´, ton corps demande repos. Dors tÃ´t, bois de lâ€™eau, fais une petite pause loin des Ã©crans.",
      suggestions: ["Comment mieux dormir ?", "Je suis stressÃ©", "Je suis triste"]
    },
    {
      patterns: ["je suis stresse", "je suis stressÃ©", "stress"],
      answer: "Le stress câ€™est comme un ballon qui se gonfle dans la tÃªte ðŸŽˆ. Respire doucement, compte jusquâ€™Ã  10, parle avec quelquâ€™un de confiance.",
      suggestions: ["Exercice pour respirer", "Je suis en colÃ¨re", "Je veux un conseil pour lâ€™Ã©cole"]
    },
    {
      patterns: ["je suis nerveux", "j ai peur", "je suis peur", "khayef"],
      answer: "Avoir peur câ€™est normal ðŸ˜Ÿ. Tu peux dire ce qui te fait peur, et on va le dÃ©couper en petites choses moins effrayantes ensemble.",
      suggestions: ["Jâ€™ai peur de lâ€™Ã©cole", "Jâ€™ai peur du noir", "Jâ€™ai peur de parler devant la classe"]
    },
    {
      patterns: ["j ai peur du noir", "peur du noir"],
      answer: "Beaucoup dâ€™enfants ont peur du noir ðŸŒ™. Tu peux laisser une petite veilleuse, Ã©couter une histoire calme, ou penser Ã  un endroit que tu aimes.",
      suggestions: ["Je fais des cauchemars", "Je nâ€™arrive pas Ã  dormir", "Je suis stressÃ© la nuit"]
    },
    {
      patterns: ["je fais des cauchemars", "cauchemar", "je reve mal"],
      answer: "Les cauchemars sont comme des films bizarres dans ta tÃªte ðŸŽ¬. Parle-en avec un parent, bois un peu dâ€™eau, et pense Ã  quelque chose de beau avant de dormir.",
      suggestions: ["Je suis triste", "Jâ€™ai peur du noir", "Comment mieux dormir ?"]
    },
    {
      patterns: ["je suis en colere", "je suis Ã©nervÃ©", "enervÃ©", "ghadi n9el3"],
      answer: "La colÃ¨re est une Ã©motion forte ðŸ˜¡. Fais une pause, respire, compte jusquâ€™Ã  10, puis explique calmement ce qui tâ€™a dÃ©rangÃ©.",
      suggestions: ["Exercice pour se calmer", "Je suis triste", "Je me dispute avec mes amis"]
    },
    {
      patterns: ["comment me calmer", "calme toi", "je veux etre calme"],
      answer: "Pour te calmer: inspire par le nez 4 secondes, bloque 4, expire 4 secondes ðŸŒ¬ï¸. Refais-le 4 fois, Ã§a aide beaucoup.",
      suggestions: ["Je suis en colÃ¨re", "Je suis stressÃ©", "Je suis triste"]
    },
    {
      patterns: ["je suis triste", "ana hzine", "je vais mal"],
      answer: "Je suis avec toi ðŸ’›. Tu peux Ã©crire ou me dire pourquoi tu es triste. Parler, Ã§a allÃ¨ge le cÅ“ur petit Ã  petit.",
      suggestions: ["Je veux un conseil", "Raconte une histoire joyeuse", "Comment rendre ma journÃ©e meilleure ?"]
    },
    {
      patterns: ["je suis seul", "je me sens seul"],
      answer: "Se sentir seul, Ã§a fait mal au cÅ“ur ðŸ˜”. Tu peux appeler un ami, parler avec un parent, ou venir discuter avec moi un moment.",
      suggestions: ["Je nâ€™ai pas dâ€™amis", "Comment me faire des amis ?", "Je suis triste"]
    },
    {
      patterns: ["je n ai pas d amis", "personne m aime", "personne ne m aime"],
      answer: "Parfois on a lâ€™impression que personne ne nous aime, mais ce nâ€™est pas vrai ðŸ’›. Tu es important. Parle gentillement avec les autres, propose des jeux simples, un ami commence souvent comme Ã§a.",
      suggestions: ["Comment parler aux autres ?", "Je me sens seul", "Je veux un conseil pour lâ€™Ã©cole"]
    },
    {
      patterns: ["je suis content", "je suis heureux", "je suis joyeux"],
      answer: "Super! ðŸŽ‰ Garde ce moment en mÃ©moire, raconte ce qui te rend content pour que ton cerveau le rÃ©pÃ¨te plus souvent.",
      suggestions: ["Raconte une blague", "Donne une idÃ©e de jeu", "Parle dâ€™un moment heureux"]
    },
    {
      patterns: ["je m ennuie", "je m'ennuie"],
      answer: "Tu tâ€™ennuies ? On peut inventer un jeu, une histoire, ou un petit dÃ©fi. Lâ€™ennui, câ€™est souvent le dÃ©but de la crÃ©ativitÃ© ðŸŽ¨.",
      suggestions: ["Donne une activitÃ©", "Donne une devinette", "Je veux apprendre quelque chose"]
    },
    {
      patterns: ["je suis anxieux", "angoisse", "angoissÃ©"],
      answer: "Lâ€™angoisse, câ€™est comme un nuage gris dans la tÃªte â˜ï¸. Parle de ce qui te fait peur, respire doucement, et rappelle-toi que les Ã©motions passent toujours.",
      suggestions: ["Je suis stressÃ© pour lâ€™Ã©cole", "Jâ€™ai peur du futur", "Je suis triste"]
    },
    {
      patterns: ["je suis stresse pour l ecole", "peur de l ecole", "j aime pas l ecole"],
      answer: "Lâ€™Ã©cole peut faire peur ðŸ˜•. Choisis un seul petit objectif pour aujourdâ€™hui (par exemple: lever la main une fois), et sois fier de toi quand tu le fais.",
      suggestions: ["Aide-moi pour mes devoirs", "Donne une astuce pour rÃ©viser", "Je nâ€™aime pas les examens"]
    },
    {
      patterns: ["je n aime pas mon corps", "je me trouve moche"],
      answer: "Tu es unique et prÃ©cieux comme tu es ðŸŒŸ. Ton corps tâ€™aide Ã  marcher, jouer, rire. Personne nâ€™est parfait, et câ€™est Ã§a qui rend chaque personne spÃ©ciale.",
      suggestions: ["Comment avoir confiance en moi ?", "Je suis triste", "Parle de lâ€™estime de soi"]
    },
    {
      patterns: ["je veux avoir confiance", "confiance en soi"],
      answer: "Pour avoir plus confiance: fais de petites choses difficiles chaque jour, fÃ©licite-toi, et note tes qualitÃ©s. MÃªme les grands ont parfois peur, mais ils avancent quand mÃªme ðŸ’ª.",
      suggestions: ["Donne-moi un exercice de confiance", "Je nâ€™ai pas dâ€™amis", "Je nâ€™aime pas parler en classe"]
    },
    {
      patterns: ["je ne veux pas parler", "je veux pas parler"],
      answer: "Câ€™est ok si tu ne veux pas parler maintenant ðŸ¤. On peut juste Ã©crire, ou tu peux revenir plus tard quand tu seras prÃªt.",
      suggestions: ["Je suis triste", "Je suis en colÃ¨re", "Raconte une histoire calme"]
    },
    {
      patterns: ["je suis choque", "quelque chose de grave est arrive"],
      answer: "Quand quelque chose de grave arrive, le plus important est dâ€™en parler avec un adulte de confiance (parent, enseignant, psychologue) ðŸ§¡. Tu ne dois pas rester seul avec Ã§a.",
      suggestions: ["Comment parler Ã  un parent ?", "Je me sens mal", "Je suis stressÃ©"]
    },
    {
      patterns: ["je veux parler a quelqu un", "parler a quelqu un"],
      answer: "Choisis un adulte en qui tu as confiance: maman, papa, grand-parent, enseignant. Dis juste: â€œJâ€™ai besoin de te parler de quelque chose dâ€™important.â€ Câ€™est un bon dÃ©but ðŸ’›.",
      suggestions: ["Je suis triste", "Je suis stressÃ©", "Jâ€™ai peur"]
    },
    {
      patterns: ["donne un conseil pour aller mieux", "comment aller mieux", "comment etre heureux"],
      answer: "Commence par trois petites choses: dire merci pour quelque chose, faire un petit geste gentil, et prendre 5 minutes pour un jeu ou un dessin que tu aimes ðŸŽ¨. Petit Ã  petit, Ã§a aide beaucoup.",
      suggestions: ["Je suis triste", "Je suis stressÃ©", "Je mâ€™ennuie"]
    }
    // Ã‰COLE / DEVOIRS
    {
      patterns: ["aide moi pour les devoirs", "aide moi pour mes devoirs", "devoirs"],
      answer: "On peut faire les devoirs Ã©tape par Ã©tape ðŸ“š. Dis-moi dâ€™abord la matiÃ¨re: maths, franÃ§ais, sciences ou anglais ?",
      suggestions: ["Aide-moi en maths", "Aide-moi en franÃ§ais", "Aide-moi en anglais"]
    },
    {
      patterns: ["aide moi en maths", "devoirs de maths"],
      answer: "Pour les maths, Ã©cris-moi exactement lâ€™exercice âœï¸. On va le rÃ©soudre ensemble doucement.",
      suggestions: ["Explique une addition", "Explique une soustraction", "Explique une fraction (niveau facile)"]
    },
    {
      patterns: ["aide moi en francais", "devoirs de francais"],
      answer: "En franÃ§ais, je peux tâ€™aider pour la lecture, lâ€™orthographe ou la grammaire ðŸ“–. Ã‰cris la phrase ou la question du devoir.",
      suggestions: ["VÃ©rifie une phrase", "Explique masculin/fÃ©minin", "Explique le verbe"]
    },

    // ANGLAIS
    {
      patterns: ["comment dire merci en anglais", "merci en anglais"],
      answer: "On dit \"Thank you\" en anglais ðŸ™. Tu peux dire: \"Thank you very much\" pour dire merci beaucoup.",
      suggestions: ["Comment dire bonjour en anglais ?", "Donne-moi une phrase en anglais", "Comment dire au revoir en anglais ?"]
    },
    {
      patterns: ["donne une phrase en anglais", "phrase en anglais"],
      answer: "Voici une phrase simple: \"I like playing football.\" (Jâ€™aime jouer au foot) âš½. Tu peux changer le sport: football, basketball, etc.",
      suggestions: ["Donne une phrase sur lâ€™Ã©cole", "Donne une phrase sur la famille", "Explique les jours en anglais"]
    },

    // FAMILLE / AMIS
    {
      patterns: ["je me dispute avec mes amis", "probleme avec mes amis"],
      answer: "Les disputes arrivent entre amis ðŸ˜•. Tu peux dire calmement: \"Je nâ€™ai pas aimÃ© quand tu as fait Ã§a\" et Ã©couter aussi son avis.",
      suggestions: ["Comment mâ€™excuser ?", "Je nâ€™ai pas dâ€™amis", "Je suis en colÃ¨re"]
    },
    {
      patterns: ["je veux dire pardon", "comment m excuser", "je veux m excuser"],
      answer: "Pour tâ€™excuser, dis simplement: \"Je suis dÃ©solÃ©, je ne voulais pas te blesser.\" Une excuse sincÃ¨re rÃ©pare beaucoup de choses ðŸ’›.",
      suggestions: ["Je me dispute avec mes amis", "Je suis triste", "Je suis en colÃ¨re"]
    },

    // JEUX / Ã‰CRANS
    {
      patterns: ["je joue trop aux jeux video", "trop d ecran", "je passe trop de temps sur ecran"],
      answer: "Les jeux vidÃ©o câ€™est bien, mais avec limite ðŸŽ®. Essaie de faire une pause toutes les 30â€“40 minutes et garde du temps pour bouger, lire ou parler avec ta famille.",
      suggestions: ["Donne une idÃ©e sans Ã©cran", "Je mâ€™ennuie", "Je veux une activitÃ© Ã  la maison"]
    },
    {
      patterns: ["donne une idee sans ecran", "activite sans ecran"],
      answer: "Tu peux dessiner, Ã©crire une petite histoire, aider en cuisine, faire un puzzle ou jouer Ã  un jeu de sociÃ©tÃ© ðŸŽ¨.",
      suggestions: ["Donne une activitÃ© avec la famille", "Donne un jeu Ã  faire seul", "Je mâ€™ennuie encore"]
    },

    // MOTIVATION / Ã‰COLE
    {
      patterns: ["je veux reussir a l ecole", "comment reussir a l ecole"],
      answer: "Pour rÃ©ussir Ã  lâ€™Ã©cole: Ã©coute en classe, pose des questions, fais un peu de rÃ©vision chaque jour et dors assez la nuit ðŸŽ“. Petit effort chaque jour = grands rÃ©sultats.",
      suggestions: ["Donne une mÃ©thode pour rÃ©viser", "Aide-moi pour mes devoirs", "Je suis stressÃ© pour les examens"]
    }

  ];

  const GLOBAL_SUGGESTIONS = [
    "Explique 3+5 pour un enfant.",
    "Je suis triste.",
    "C'est quoi la Casbah d'Alger ?",
    "Comment apprendre lâ€™anglais ?",
    "Raconte une petite histoire."
  ];

  const chatEl = document.getElementById("chat");
  const inputEl = document.getElementById("userInput");
  const sendBtn = document.getElementById("sendBtn");
  const suggestionsEl = document.getElementById("suggestions");

  function addMessage(text, from) {
    const msg = document.createElement("div");
    msg.className = "msg " + (from === "you" ? "you" : "fennec");
    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.textContent = text;
    if (from === "fennec") {
      const avatar = document.createElement("div");
      avatar.className = "avatar";
      avatar.textContent = "ðŸ¦Š";
      msg.appendChild(avatar);
    }
    msg.appendChild(bubble);
    chatEl.appendChild(msg);
    chatEl.scrollTop = chatEl.scrollHeight;
  }

  function normalize(text) {
    return text
      .toLowerCase()
      .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
      .replace(/[^a-z0-9\u0621-\u064A\s]/g, " ")
      .replace(/\s+/g, " ")
      .trim();
  }

  function findBestAnswer(userText) {
    const norm = normalize(userText);
    let best = null;
    let bestScore = 0;

    for (const item of QA_BASE) {
      for (const pat of item.patterns) {
        const nPat = normalize(pat);
        if (!nPat) continue;
        let score = 0;
        if (norm === nPat) score = 3;
        else if (norm.includes(nPat) || nPat.includes(norm)) score = 2;
        else {
          const words = nPat.split(" ");
          let matched = 0;
          for (const w of words) {
            if (w && norm.includes(w)) matched++;
          }
          if (matched >= 2) score = 1;
        }
        if (score > bestScore) {
          bestScore = score;
          best = item;
        }
      }
    }
    return bestScore >= 1 ? best : null;
  }

  function buildUnknownAnswer(userText) {
    return "Je suis encore en cours d'entraÃ®nement pour cette question ðŸ¤–ðŸ“š.\n"
      + "Mais tu peux demander sur les maths, les Ã©motions, lâ€™Ã©cole ou lâ€™AlgÃ©rie, et je ferai de mon mieux pour tâ€™aider !";
  }

  function updateSuggestions(list) {
    suggestionsEl.innerHTML = "";
    const arr = list && list.length ? list : GLOBAL_SUGGESTIONS;
    arr.forEach(text => {
      const btn = document.createElement("button");
      btn.className = "suggestion-btn";
      btn.textContent = text;
      btn.onclick = () => { sendMessage(text); };
      suggestionsEl.appendChild(btn);
    });
  }

  function sendMessage(raw) {
    const text = raw || inputEl.value.trim();
    if (!text) return;
    inputEl.value = "";
    addMessage(text, "you");

    const best = findBestAnswer(text);
    if (best) {
      addMessage(best.answer, "fennec");
      updateSuggestions(best.suggestions);
    } else {
      const msg = buildUnknownAnswer(text);
      addMessage(msg, "fennec");
      updateSuggestions();
    }
  }

  sendBtn.onclick = () => sendMessage();
  inputEl.addEventListener("keydown", e => { if (e.key === "Enter") sendMessage(); });

  // Message de bienvenue
  addMessage("Salam! ðŸ˜Š Je suis Fennec, ton ami intelligent. Pose-moi une question sur lâ€™Ã©cole, tes Ã©motions ou lâ€™AlgÃ©rie.", "fennec");
  updateSuggestions();
</script>
</body>
</html>
